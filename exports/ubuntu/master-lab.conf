input {                                                                                                                                                                                                                                        file {                                                                                                                                                                                                                                         path => "/var/log/suricata/eve.json"                                                                                                                                                                                                         codec => "json"                                                                                                                                                                                                                              start_position => "beginning"                                                                                                                                                                                                                # FORCE the tag here                                                                                                                                                                                                                         add_field => { "log_source" => "suricata" }                                                                                                                                                                                                }                                                                                                                                                                                                                                            beats {                                                                                                                                                                                                                                        port => 5044                                                                                                                                                                                                                                 # FORCE the tag here                                                                                                                                                                                                                         add_field => { "log_source" => "winlogbeat" }                                                                                                                                                                                              }                                                                                                                                                                                                                                          }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         filter {                                                                                                                                                                                                                                       # If it looks like Suricata, do GeoIP                                                                                                                                                                                                        if [dest_ip] and [event_type] {                                                                                                                                                                                                                if [dest_ip] !~ /^10\.|^192\.168\.|^172\.(1[6-9]|2[0-9]|3[0-1])\./ {                                                                                                                                                                           geoip {                                                                                                                                                                                                                                        source => "dest_ip"                                                                                                                                                                                                                          target => "geo"                                                                                                                                                                                                                            }                                                                                                                                                                                                                                          }                                                                                                                                                                                                                                          }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         # If it looks like Windows Sysmon, do GeoIP                                                                                                                                                                                                  if [winlog][event_data][DestinationIp] {                                                                                                                                                                                                       if [winlog][event_data][DestinationIp] !~ /^10\.|^192\.168\.|^172\.(1[6-9]|2[0-9]|3[0-1])\./ {                                                                                                                                                 geoip {                                                                                                                                                                                                                                        source => "[winlog][event_data][DestinationIp]"                                                                                                                                                                                              target => "geo"                                                                                                                                                                                                                            }                                                                                                                                                                                                                                          }                                                                                                                                                                                                                                          }                                                                                                                                                                                                                                          }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         output {                                                                                                                                                                                                                                       elasticsearch {                                                                                                                                                                                                                                hosts => ["https://localhost:9200"]                                                                                                                                                                                                          user => "elastic"                                                                                                                                                                                                                            password => "${ES_PWD}"                                                                                                                                                                                                                      ssl_verification_mode => "none"                                                                                                                                                                                                              index => "%{log_source}-%{+YYYY.MM.dd}"                                                                                                                                                                                                    }                                                                                                                                                                                                                                          }                                         input {
  file {
    path => "/var/log/suricata/eve.json"
    codec => "json"
    start_position => "beginning"
    # FORCE the tag here
    add_field => { "log_source" => "suricata" }
  }
  beats {
    port => 5044
    # FORCE the tag here
    add_field => { "log_source" => "winlogbeat" }
  }
}

filter {
  # If it looks like Suricata, do GeoIP
  if [dest_ip] and [event_type] {
    if [dest_ip] !~ /^10\.|^192\.168\.|^172\.(1[6-9]|2[0-9]|3[0-1])\./ {
      geoip {
        source => "dest_ip"
        target => "geo"
      }
    }
  }

  # If it looks like Windows Sysmon, do GeoIP
  if [winlog][event_data][DestinationIp] {
    if [winlog][event_data][DestinationIp] !~ /^10\.|^192\.168\.|^172\.(1[6-9]|2[0-9]|3[0-1])\./ {
      geoip {
        source => "[winlog][event_data][DestinationIp]"
        target => "geo"
      }
    }
  }
}

output {
  elasticsearch {
    hosts => ["https://localhost:9200"]
    user => "elastic"
    password => "${ES_PWD}"
    ssl_verification_mode => "none"
    index => "%{log_source}-%{+YYYY.MM.dd}"
  }
}